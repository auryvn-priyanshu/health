<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIVYA-DATA | 3D Vedic Bio-Astro</title>
    <!-- Three.js for 3D Elements -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Chart.js and Icons -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600;800&family=Noto+Sans+Devanagari:wght@400;700&display=swap');

        :root {
            --gold: #D4AF37;
            --deep-space: #050505;
            --mystic-purple: #4C1D95;
            --ethereal-pink: #9D174D;
            --glass: rgba(10, 10, 10, 0.85);
            --text-gold: #F3E5AB;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--deep-space);
            color: white;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .sanskrit { font-family: 'Cinzel', serif; letter-spacing: 0.1em; color: var(--gold); }
        .devanagari { font-family: 'Noto Sans Devanagari', sans-serif; color: var(--gold); }

        .overlay {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header { text-align: center; margin-bottom: 3rem; pointer-events: none; }
        header h1 { font-size: 3.5rem; text-shadow: 0 0 20px rgba(212, 175, 55, 0.5); }

        .oracle-card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 40px;
            padding: 3rem;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            margin-bottom: 2rem;
        }

        /* Forms */
        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }
        .field { display: flex; flex-direction: column; gap: 0.5rem; }
        label { font-size: 0.7rem; font-weight: 800; color: var(--gold); text-transform: uppercase; }
        input, select { 
            background: rgba(255, 255, 255, 0.05); 
            border: 1px solid rgba(212, 175, 55, 0.3); 
            color: white; padding: 1rem; border-radius: 15px; 
            transition: 0.3s;
        }
        input:focus { outline: none; border-color: var(--gold); background: rgba(255, 255, 255, 0.1); }

        .btn-invoke {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, var(--gold), #B45309);
            color: black; border: none; padding: 1.5rem; border-radius: 20px;
            font-family: 'Cinzel', serif; font-weight: 700; font-size: 1.2rem;
            cursor: pointer; transition: 0.3s; margin-top: 1rem;
        }
        .btn-invoke:hover { transform: scale(1.02); filter: brightness(1.2); }

        /* Dashboard */
        #results { display: none; }
        .metric-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem; }
        .metric-box { 
            background: rgba(255, 255, 255, 0.03); 
            padding: 1.5rem; border-radius: 20px; 
            text-align: center; border: 1px solid rgba(255,255,255,0.05);
        }
        .metric-val { font-size: 2.5rem; font-weight: 900; color: var(--text-gold); }

        .details { display: grid; grid-template-columns: 1.6fr 1fr; gap: 2rem; }
        @media (max-width: 900px) { .details { grid-template-columns: 1fr; } }

        .insight-content { font-size: 1.05rem; line-height: 1.8; color: #d1d5db; }
        .insight-content b { color: var(--gold); }

        .upaya-list { display: flex; flex-direction: column; gap: 1rem; }
        .upaya-item { background: rgba(212, 175, 55, 0.05); padding: 1.2rem; border-radius: 20px; border-left: 4px solid var(--gold); }

        /* Loader */
        #loader { display: none; text-align: center; padding: 5rem; }
        .lotus-loader {
            width: 100px; height: 100px; border: 4px solid var(--gold);
            border-top: 4px solid transparent; border-radius: 50%;
            animation: spin 2s linear infinite; margin: 0 auto 2rem;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .chart-wrap { background: rgba(0,0,0,0.3); border-radius: 25px; padding: 1.5rem; margin-top: 1.5rem; height: 300px; }
    </style>
</head>
<body>

<div id="canvas-container"></div>

<div class="overlay">
    <header>
        <div class="sanskrit" style="font-size: 0.8rem; margin-bottom: 0.5rem;">DIVYA-DATA PRESENTS</div>
        <h1 class="sanskrit">Celestial Bio-Oracle</h1>
        <p class="devanagari">ब्रह्माण्डं जीवशक्तिश्च</p>
    </header>

    <div class="oracle-card" id="form-box">
        <div class="grid-inputs">
            <div class="field">
                <label>Janma Tithi (Birth Date)</label>
                <input type="date" id="birthDate">
            </div>
            <div class="field">
                <label>Samaya (Birth Time)</label>
                <input type="time" id="birthTime" value="12:00">
            </div>
            <div class="field">
                <label>Sankalpa (Intention)</label>
                <select id="goal">
                    <option value="ojas">Strengthen Ojas (Vital Essence)</option>
                    <option value="tejas">Ignite Tejas (Metabolic Fire)</option>
                    <option value="prana">Clarify Prana (Breath Force)</option>
                </select>
            </div>
            <button class="btn-invoke" onclick="startReading()">Invoke Cosmic Insight</button>
        </div>
    </div>

    <div id="loader">
        <div class="lotus-loader"></div>
        <h2 class="sanskrit">Calculating Planetary Lagna...</h2>
        <p>Aligning the 27 Nakshatras with your Dhatu strength</p>
    </div>

    <div id="results">
        <div class="metric-grid">
            <div class="metric-box">
                <div class="tile-title sanskrit" style="font-size: 0.6rem;">OJAS</div>
                <div class="metric-val" id="res-ojas">0</div>
                <div class="devanagari">ओजस्</div>
            </div>
            <div class="metric-box">
                <div class="tile-title sanskrit" style="font-size: 0.6rem;">PRANA</div>
                <div class="metric-val" id="res-prana">0</div>
                <div class="devanagari">प्राण</div>
            </div>
            <div class="metric-box">
                <div class="tile-title sanskrit" style="font-size: 0.6rem;">TEJAS</div>
                <div class="metric-val" id="res-tejas">0</div>
                <div class="devanagari">तेजस्</div>
            </div>
            <div class="metric-box">
                <div class="tile-title sanskrit" style="font-size: 0.6rem;">VIBE</div>
                <div class="metric-val" id="res-vibe">0</div>
                <div class="devanagari">ऊर्जा</div>
            </div>
        </div>

        <div class="details">
            <div class="oracle-card">
                <h2 class="sanskrit" style="font-size: 1.2rem; margin-bottom: 1.5rem;">Divine Interpretation</h2>
                <div class="insight-content" id="insight-text"></div>
                <div class="chart-wrap">
                    <canvas id="bioGraph"></canvas>
                </div>
            </div>
            <div class="oracle-card">
                <h2 class="sanskrit" style="font-size: 1.2rem; margin-bottom: 1.5rem;">Recommended Upayas</h2>
                <div id="upaya-list" class="upaya-list"></div>
                <div class="chart-wrap" style="height: 250px;">
                    <canvas id="gunaRadar"></canvas>
                </div>
            </div>
        </div>
        
        <div style="text-align:center; padding: 2rem;">
            <button class="btn-invoke" style="width: auto; padding: 1rem 3rem;" onclick="location.reload()">Reset Portal</button>
        </div>
    </div>
</div>

<script>
    // --- 3D ENVIRONMENT (THREE.JS) ---
    let scene, camera, renderer, stars, mandala;

    function init3D() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Stars
        const starGeometry = new THREE.BufferGeometry();
        const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.1 });
        const starVertices = [];
        for (let i = 0; i < 5000; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            starVertices.push(x, y, z);
        }
        starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
        stars = new THREE.Points(starGeometry, starMaterial);
        scene.add(stars);

        // Mystic Mandala (Torus)
        const geometry = new THREE.TorusKnotGeometry(10, 3, 100, 16);
        const material = new THREE.MeshBasicMaterial({ color: 0xd4af37, wireframe: true, transparent: true, opacity: 0.15 });
        mandala = new THREE.Mesh(geometry, material);
        scene.add(mandala);

        camera.position.z = 50;
        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        stars.rotation.y += 0.0005;
        mandala.rotation.x += 0.002;
        mandala.rotation.y += 0.001;
        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // --- LOGIC ENGINE ---
    let bChart = null;
    let gChart = null;

    function startReading() {
        const bDate = document.getElementById('birthDate').value;
        if (!bDate) return;

        document.getElementById('form-box').style.display = 'none';
        document.getElementById('loader').style.display = 'block';

        // Animate Mandala
        mandala.material.opacity = 0.6;
        mandala.scale.set(1.5, 1.5, 1.5);

        setTimeout(() => {
            const data = calculateVedicBio(bDate);
            renderResults(data);
            document.getElementById('loader').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            lucide.createIcons();
        }, 3000);
    }

    function calculateVedicBio(dateStr) {
        const d = new Date(dateStr);
        const day = d.getDate();
        const mon = d.getMonth() + 1;
        const year = d.getFullYear();

        // Sidereal Rashi (Approximation with -24 deg Ayanamsa)
        const signs = ["Makara", "Kumbha", "Meena", "Mesha", "Vrishabha", "Mithuna", "Karka", "Simha", "Kanya", "Tula", "Vrischika", "Dhanu"];
        const boundaries = [19, 18, 20, 19, 20, 20, 22, 22, 22, 22, 21, 21];
        let idx = (day > boundaries[mon - 1]) ? mon : mon - 1;
        if (idx > 11) idx = 0;
        const rashi = signs[(idx - 1 < 0) ? 11 : idx - 1];

        // Advanced Scores
        const ojas = 40 + (day % 15) * 4;
        const prana = 50 + (mon % 10) * 4;
        const tejas = 30 + (day % 7) * 9;
        const vibe = Math.round((ojas + prana + tejas) / 3);

        const nakshatras = ["Ashwini", "Rohini", "Ardra", "Pushya", "Magha", "Chitra", "Swati", "Anuradha", "Mula", "Shravana", "Revati"];
        const nak = nakshatras[(day + mon) % 11];

        return { rashi, nak, ojas, prana, tejas, vibe, day };
    }

    function renderResults(data) {
        document.getElementById('res-ojas').innerText = data.ojas;
        document.getElementById('res-prana').innerText = data.prana;
        document.getElementById('res-tejas').innerText = data.tejas;
        document.getElementById('res-vibe').innerText = data.vibe;

        const bodyPart = getVedicBodyPart(data.rashi);

        document.getElementById('insight-text').innerHTML = `
            <p>Scanning your <b>Janma Rashi (${data.rashi})</b> and <b>${data.nak} Nakshatra</b> placement. 
            The cosmic geometry reveals that your <b>Ojas</b> reserve is currently at <b>${data.ojas}%</b>, manifesting as physical immunity in the <b>${bodyPart}</b>.</p>
            <p style="margin-top:1.5rem"><b>Dhatu Analysis:</b> Your blood plasma (Rasa Dhatu) is highly responsive to lunar cycles. With a vibe index of ${data.vibe}, you are currently in an <b>Expansion Phase</b>. However, your <b>Tejas</b> indicates a need for digestive discipline to prevent metabolic acidity.</p>
        `;

        const upayas = [
            { icon: 'zap', title: 'Solar Breath', desc: 'Activate Surya Bhedana (Right nostril) for 5 minutes before meals.' },
            { icon: 'moon', title: 'Soma Ritual', desc: 'Consume moon-charged water to stabilize Rasa Dhatu.' },
            { icon: 'shield', title: 'Aura Seal', desc: 'Wear sandalwood oil on your pulse points to ground excess Vata.' }
        ];

        document.getElementById('upaya-list').innerHTML = upayas.map(u => `
            <div class="upaya-item">
                <div style="display:flex; align-items:center; gap:0.7rem; font-weight:800; color:var(--gold);">
                    <i data-lucide="${u.icon}" style="width:16px"></i> ${u.title}
                </div>
                <div style="font-size:0.85rem; opacity:0.8; margin-top:0.3rem">${u.desc}</div>
            </div>
        `).join('');

        initCharts(data);
    }

    function getVedicBodyPart(r) {
        const m = { "Mesha": "Head", "Vrishabha": "Face/Eyes", "Mithuna": "Chest/Lungs", "Karka": "Heart", "Simha": "Upper Gut", "Kanya": "Lower Gut", "Tula": "Pelvis", "Vrischika": "Sacrum", "Dhanu": "Thighs", "Makara": "Knees", "Kumbha": "Calves", "Meena": "Feet" };
        return m[r] || "Whole Physiology";
    }

    function initCharts(data) {
        if (bChart) bChart.destroy();
        if (gChart) gChart.destroy();

        const ctxB = document.getElementById('bioGraph').getContext('2d');
        bChart = new Chart(ctxB, {
            type: 'line',
            data: {
                labels: ['Dawn', 'Noon', 'Evening', 'Night'],
                datasets: [{
                    label: 'Metabolic Prana',
                    data: [data.prana, data.prana*1.3, data.prana*0.8, data.prana*0.4],
                    borderColor: '#D4AF37',
                    backgroundColor: 'rgba(212, 175, 55, 0.1)',
                    fill: true, tension: 0.4
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
        });

        const ctxG = document.getElementById('gunaRadar').getContext('2d');
        gChart = new Chart(ctxG, {
            type: 'radar',
            data: {
                labels: ['Sattva', 'Rajas', 'Tamas', 'Dharma'],
                datasets: [{
                    data: [data.ojas, data.tejas, 100-data.vibe, data.prana],
                    borderColor: '#9D174D',
                    backgroundColor: 'rgba(157, 23, 77, 0.2)'
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { r: { ticks: { display: false }, grid: { color: 'rgba(255,255,255,0.1)' } } } }
        });
    }

    window.onload = init3D;
</script>

</body>
</html>
